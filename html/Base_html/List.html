<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>xlsx编辑</title>
    <style>
        *{
            margin:0;
            padding:0;
        }
        body,head,html{
            width: 100%;
            height:100%;
        }
    </style>
</head>
<body>
    <div id="placeholder"></div>
    <script type="text/javascript" src="http://127.0.0.1:9000/5.3.0-243/web-apps/apps/api/documents/api.js"></script>
    <script>
        config = {
            "document": {
                "fileType": "xlsx",
                "url": "http://192.168.1.213:8080/test/2.xlsx"
            },
            "documentType": "spreadsheet",
            "editorConfig": {
                "callbackUrl": "http://192.168.1.213:8080/demo/excel_callback",
                "lang": "zh-CN",
                "customization":{
                    "forcesave":"true"
                }
            },
            "width":"100%",
            "height":"100%",
        };
        var docEditor = new DocsAPI.DocEditor("placeholder", config);

        var message;
        function Socket(url){
            var xmlhttp;
            if (window.XMLHttpRequest)
            {
                xmlhttp=new XMLHttpRequest();
            }
            else
            {
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    message = xmlhttp.responseText;
                    console.log(message);
                }
            }
            xmlhttp.open("GET",url,true);
            xmlhttp.send();
        }

        function flag(){
            if(message == 1){
                Socket("http://192.168.1.213:8080/demo/excel_utlis?con=InitializeFlag");
                alert("Excel入库完成！");
            }else{
                Socket("http://192.168.1.213:8080/demo/excel_utlis?con=GetFlag");
            }
        }
        setInterval(flag,300);
    </script>
</body>
</html>
